<!-- success.html (Reeflux.com) -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Access Granted · Reeflux</title>
  <link rel="stylesheet" href="/styles.css" />
</head>

<body>
  <div class="poolShell" style="max-width: 920px;">
    <section class="panel panel--padded">
      <h1 id="title">Checking access…</h1>
      <p id="msg" style="margin-top:10px;"></p>

      <div style="margin-top:16px; display:flex; gap:10px; flex-wrap:wrap;">
        <a class="pillLink" id="returnPool" href="/index.html" style="text-decoration:none;">Return</a>
        <a class="ghostBtn" id="goHome" href="/index.html" style="text-decoration:none;">Home</a>
      </div>

      <div class="smallNote" style="margin-top:14px;">
        If you don’t see access after returning, click “Refresh Access” on the pool page.
      </div>
    </section>
  </div>

  <script>
    (function () {
      const qs = new URLSearchParams(window.location.search);
      const ok = qs.get("ok") === "1";
      const pool = (qs.get("pool") || "").trim();
      const product = (qs.get("product") || "").trim();
      const reason = (qs.get("reason") || "").trim();

      const titleEl = document.getElementById("title");
      const msgEl = document.getElementById("msg");
      const returnEl = document.getElementById("returnPool");

      // Map pool slug -> file
      const poolToPath = {
        ambient: "/ambient.html",
        fractal: "/fractal.html",
        sandbox: "/sandbox.html",
        signal: "/signal.html",
        tide: "/tide-deck.html",
      };

      const target = poolToPath[pool] || "/index.html";
      returnEl.href = target;
      returnEl.textContent = pool ? `Return to ${pool}` : "Return to Reef";

      if (!ok) {
        titleEl.textContent = "Payment not verified";
        msgEl.textContent = reason
          ? `We couldn't verify the payment yet (reason: ${reason}). If you just paid, wait a moment and try again from the pool.`
          : "We couldn't verify the payment yet. If you just paid, try again from the pool.";
        return;
      }

      // ✅ MVP unlock on this device
      try {
        localStorage.setItem("reefpass", "true");
        localStorage.setItem("reefpass_set_at", String(Date.now()));
        if (pool) localStorage.setItem("reefpass_pool", pool);
        if (product) localStorage.setItem("reefpass_product", product);
      } catch (e) {
        // If localStorage fails, cookie may still work (if you later read it in app.js)
      }

      titleEl.textContent = "Access granted";
      msgEl.textContent = pool
        ? `You're unlocked for: ${pool}. You can return now.`
        : "You're unlocked. You can return now.";

      // Auto-redirect after a moment (nice UX)
      setTimeout(() => {
        window.location.href = target;
      }, 900);
    })();
  </script>
</body>
</html>
