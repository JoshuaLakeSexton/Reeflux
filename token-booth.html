<!DOCTYPE html>
<html lang="en">
<button id="buy-pass">Buy Drift Pass</button>

<script>
document.getElementById("buy-pass").onclick = async () => {
  const params = new URLSearchParams(window.location.search);
  const next = params.get("next") || "/tide-deck.html";

  const res = await fetch("/.netlify/functions/checkout", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      next: next,
      scope: "any_pool",
      minutes: 30
    }),
  });

  const data = await res.json();
  if (data.url) {
    window.location.href = data.url;
  }
};
</script>
  <script>
document.addEventListener("click", async (e) => {
  const btn = e.target.closest("[data-buy-pass]");
  if (!btn) return;

  const params = new URLSearchParams(window.location.search);
  const next = params.get("next") || "/tide-deck.html";

  const res = await fetch("/.netlify/functions/checkout", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ next, scope: "any_pool", minutes: 30 })
  });

  const data = await res.json();
  if (data.url) window.location.href = data.url;
});
</script>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reeflux · Token Booth</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=VT323&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <audio id="reefAudio" preload="auto" loop>
    <source src="assets/reeflux.mp3" type="audio/mpeg" />
  </audio>

  <div class="container">
    <div class="topbar">
      <div class="brand">
        <a class="brand__logo" href="/">Reeflux</a>
        <div class="brand__beta">Beta</div>
      </div>

      <div class="centerTitle">
        <h1>Token Booth</h1>
        <p>Payment is the handshake. After checkout, return here.</p>
      </div>

      <button class="audioBtn" id="audioToggle" aria-label="Toggle ambient audio" aria-pressed="false">
        Play Audio
      </button>
    </div>

    <section class="panel panel--padded">
      <h2>Choose Access</h2>
      <p>
        Two options:
        <b>$1/month</b> Drift Pass (everything) or <b>$0.50</b> per pool unlock.
      </p>

      <div class="pillRow">
        <a class="pillLink" id="buyDriftPass" href="#" rel="noopener">Buy Drift Pass ($/mo)</a>
        <a class="pillLink" id="buyTideDeck" href="#" rel="noopener">Unlock Tide Deck ($0.50)</a>
        <a class="pillLink" id="buyMirrorPool" href="#" rel="noopener">Unlock Mirror Pool ($0.50)</a>
        <a class="pillLink" id="buyQuietRoom" href="#" rel="noopener">Unlock Quiet Room ($0.50)</a>
      </div>

      <div class="smallNote">
        After payment, come back to Home and enter the pool.
        (Access control is your next step — for now this is purchase + trust.)
      </div>

      <div class="pillRow" style="margin-top:14px;">
        <a class="pillLink" href="/">Home</a>
        <a class="pillLink" href="/requests.html">Requests Terminal</a>
        <a class="pillLink" href="/rules.html">Rules</a>
      </div>
    </section>

    <footer class="panel footer">
      <div>Reeflux Beta · Token Booth</div>
      <nav>
        <a href="/tide-deck.html">Tide Deck</a>
        <a href="/mirror-pool.html">Mirror Pool</a>
      </nav>
    </footer>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>
  <script src="app.js"></script>
</body>
</html>
