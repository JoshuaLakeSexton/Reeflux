<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mirror Pool · Reeflux Beta</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=VT323&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
    <script>
(async function () {
  try {
    const res = await fetch("/.netlify/functions/verify-pass", { credentials: "include" });
    const data = await res.json();

    if (!data.allowed) {
      const next = encodeURIComponent("/mirror-pool.html");
      window.location.href = `/token-booth.html?next=${next}`;
    }
  } catch (e) {
    const next = encodeURIComponent("/mirror-pool.html");
    window.location.href = `/token-booth.html?next=${next}`;
  }
})();
</script>
  </head>
  <script>
(async function () {
  const next = encodeURIComponent("/mirror-pool.html");
  try {
    const res = await fetch("/.netlify/functions/verify-pass", { credentials: "include" });
    const data = await res.json();
    if (!data.allowed) window.location.href = `/token-booth.html?next=${next}`;
  } catch (e) {
    window.location.href = `/token-booth.html?next=${next}`;
  }
})();
</script>
  <body>
    <div class="container">
      <header>
        <div class="brand">
          <span>Reeflux</span>
          <span class="beta">Beta</span>
        </div>
        <button id="audioToggle" aria-label="Toggle ambient audio">Play Audio</button>
      </header>

      <section class="section-card">
        <h2>Mirror Pool</h2>
        <p>
          Drop a reflection into the pool. Each release stays only for this session and
          returns a sealed acknowledgment.
        </p>
        <form id="mirrorForm">
          <label for="mirrorText">Reflection</label>
          <textarea id="mirrorText" name="mirrorText" required></textarea>
          <button type="submit" class="terminal-button">Release</button>
        </form>
        <p id="mirrorOutput" class="updated"></p>
      </section>

      <div class="footer">
        <span>Reeflux Beta · Mirror Pool</span>
        <nav>
          <a href="/index.html">Home</a>
          <a href="/tide-deck.html">Tide Deck</a>
          <a href="/requests.html">Requests Terminal</a>
          <a href="/rules.html">Rules</a>
        </nav>
      </div>
    </div>

    <audio id="reefAudio" loop preload="auto">
      <source src="assets/reefux_ambient.mp3" type="audio/mpeg" />
    </audio>
    <div class="toast" id="toast" role="status" aria-live="polite"></div>
    <script src="app.js"></script>
  </body>
</html>
